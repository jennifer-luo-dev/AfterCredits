{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/jennifer/personalprojects/AfterCredits/aftercredits/src/app/api/storage/upload/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { createClient as createSupabaseClient } from \"@supabase/supabase-js\";\n\nconst SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nexport async function POST(request: Request) {\n  if (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE_KEY) {\n    return NextResponse.json(\n      { error: \"Missing SUPABASE_SERVICE_ROLE_KEY\" },\n      { status: 500 }\n    );\n  }\n\n  try {\n    const form = await request.formData();\n    const file = form.get(\"file\") as any;\n    const path = form.get(\"path\") as string | null;\n\n    if (!file || !path) {\n      return NextResponse.json(\n        { error: \"file and path are required\" },\n        { status: 400 }\n      );\n    }\n\n    const supabaseAdmin = createSupabaseClient(\n      SUPABASE_URL,\n      SUPABASE_SERVICE_ROLE_KEY,\n      {\n        auth: { persistSession: false },\n      }\n    );\n\n    // Convert the form File to an ArrayBuffer -> Buffer\n    const arrayBuffer = await file.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n\n    const { data, error } = await supabaseAdmin.storage\n      .from(\"memories\")\n      .upload(path, buffer, { contentType: file.type, upsert: false });\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    return NextResponse.json({ path: data?.path ?? path }, { status: 201 });\n  } catch (err: any) {\n    console.error(\"Upload endpoint error:\", err);\n    return NextResponse.json(\n      { error: err?.message ?? \"Upload failed\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM;AACN,MAAM,4BAA4B,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,eAAe,KAAK,OAAgB;IACzC,IAAI,CAAC,gBAAgB,CAAC,2BAA2B;QAC/C,OAAO,oMAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoC,GAC7C;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,QAAQ;QACnC,MAAM,OAAO,KAAK,GAAG,CAAC;QACtB,MAAM,OAAO,KAAK,GAAG,CAAC;QAEtB,IAAI,CAAC,QAAQ,CAAC,MAAM;YAClB,OAAO,oMAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,gBAAgB,IAAA,oPAAoB,EACxC,cACA,2BACA;YACE,MAAM;gBAAE,gBAAgB;YAAM;QAChC;QAGF,oDAAoD;QACpD,MAAM,cAAc,MAAM,KAAK,WAAW;QAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAAc,OAAO,CAChD,IAAI,CAAC,YACL,MAAM,CAAC,MAAM,QAAQ;YAAE,aAAa,KAAK,IAAI;YAAE,QAAQ;QAAM;QAEhE,IAAI,OAAO;YACT,OAAO,oMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,OAAO,oMAAY,CAAC,IAAI,CAAC;YAAE,MAAM,MAAM,QAAQ;QAAK,GAAG;YAAE,QAAQ;QAAI;IACvE,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,oMAAY,CAAC,IAAI,CACtB;YAAE,OAAO,KAAK,WAAW;QAAgB,GACzC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}